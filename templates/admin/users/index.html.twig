{# templates/admin/users/index.html.twig #}
{% extends 'admin.html.twig' %}

{% block title %}Manage Users{% endblock %}

{% block body %}
<div class="flex items-center justify-between mb-4">
  <h1 class="text-2xl font-semibold">Manage Users</h1>

  <div class="flex items-center gap-2">
    <a href="{{ path('admin_user_create_staff') }}"
       class="btn btn-sm md:btn-md btn-primary">
      + Add staff
    </a>
    <a href="{{ path('admin_user_create_admin') }}"
       class="btn btn-sm md:btn-md btn-secondary">
      + Add admin
    </a>
  </div>
</div>

<div class="overflow-x-auto bg-base-100 rounded-xl shadow">
  <table class="table table-zebra w-full">
    <thead>
      <tr>
        <th class="w-16">ID</th>
        <th>Email</th>
        <th>Name</th>
        <th class="w-64">Roles</th>
      </tr>
    </thead>
    <tbody>
    {% for u in users %}
      <tr>
        <td>#{{ u.id }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.fullName ?? '—' }}</td>
        <td>
          <div class="flex flex-wrap gap-1">
            {% set labels = {
              'ROLE_ADMIN':    'Admin',
              'ROLE_STAFF':    'Staff',
              'ROLE_CUSTOMER': 'Customer'
            } %}

            {% for r in u.roles %}
              {% if r != 'ROLE_USER' %}
                {% set label = labels[r] ?? r %}

                {% set colorClass = 'badge-ghost' %}
                {% if r == 'ROLE_ADMIN' %}
                  {% set colorClass = 'badge-secondary' %}
                {% elseif r == 'ROLE_STAFF' %}
                  {% set colorClass = 'badge-info' %}
                {% elseif r == 'ROLE_CUSTOMER' %}
                  {% set colorClass = 'badge-success' %}
                {% endif %}

                <span class="badge {{ colorClass }} badge-sm px-3">
                  {{ label }}
                </span>
              {% endif %}
            {% endfor %}
          </div>
        </td>
      </tr>
    {% else %}
      <tr>
        <td colspan="4" class="text-center text-sm py-6 text-base-content/70">
          No users found.
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

{% if pageCount is defined and pageCount > 1 %}
  {% set route = app.request.attributes.get('_route') %}
  {% set query = app.request.query.all %}
  <div class="mt-4 flex justify-center">
    <div class="join">
      <a class="join-item btn btn-sm {{ page <= 1 ? 'btn-disabled' }}"
         href="{{ page <= 1 ? '#' : path(route, query|merge({'page': page-1})) }}">
        « Prev
      </a>
      <span class="join-item btn btn-sm btn-ghost no-pointer-events">
        Page {{ page }} / {{ pageCount }}
      </span>
      <a class="join-item btn btn-sm {{ page >= pageCount ? 'btn-disabled' }}"
         href="{{ page >= pageCount ? '#' : path(route, query|merge({'page': page+1})) }}">
        Next »
      </a>
    </div>
  </div>
{% endif %}
{% endblock %}

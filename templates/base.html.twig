{# templates/base.html.twig #}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}PC Store{% endblock %}</title>
    {% block stylesheets %}
        {{ encore_entry_link_tags('app') }}
    {% endblock %}

    {% block javascripts %}
        {{ encore_entry_script_tags('app') }}
    {% endblock %}
  </head>
  <body class="flex flex-col min-h-screen bg-gray-100">

  {# --- Navbar --- #}
  {% block navbar %}
  <div class="navbar bg-base-100 shadow-sm fixed top-0 left-0 right-0 z-50">
    <div class="flex-1">
      <a class="btn btn-ghost text-xl" href="{{ path('app_homepage') }}">PC Store</a>
    </div>
    <div class="flex items-center gap-2">
      <form action="{{ path('app_homepage') }}" method="get" class="hidden md:block">
        <input type="text" name="q" value="{{ app.request.get('q') }}" placeholder="Search products..." class="input input-bordered w-48 md:w-64" />
      </form>

      {% if app.user %}
        {# Cart icon #}
        {% set _raw = app.session.get('cart', {}) %}
        {% set _count = 0 %}
        {% for q in _raw %}{% set _count = _count + q %}{% endfor %}

        <div class="indicator mr-1">
          <a href="{{ path('app_cart_index') }}" class="btn btn-ghost btn-circle" aria-label="Cart">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 12.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
          </a>
          {% if _count > 0 %}
            <span class="indicator-item badge badge-primary badge-sm">{{ _count }}</span>
          {% endif %}
        </div>

        {# Avatar dropdown #}
        <div class="dropdown dropdown-end">
          <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
            <div class="w-10 rounded-full">
              <img alt="{{ app.user.userIdentifier }}" src="https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.webp" />
            </div>
          </div>
          <ul tabindex="0" class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[60] mt-3 w-56 p-2 shadow">
            <li class="menu-title px-4">{{ app.user.userIdentifier }}</li>
            <li><a href="{{ path('app_orders_index') }}">My Orders</a></li>
            <li><a href="#">Profile</a></li>
            <li><a href="{{ path('app_admin') }}">Dashboard</a></li>
            <li class="mt-2">
              <form method="post" action="{{ path('app_logout') }}">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token('logout') }}">
                <button type="submit" class="btn btn-error btn-sm w-full">Logout</button>
              </form>
            </li>
          </ul>
        </div>
      {% else %}
        <div class="flex gap-2">
          <a href="{{ path('app_login') }}" class="btn btn-ghost">Login</a>
          <a href="{{ path('app_register') }}" class="btn btn-primary">Register</a>
        </div>
      {% endif %}
    </div>
  </div>
  <div class="h-16"></div>
  {% endblock %}

  <main class="flex-grow container mx-auto px-4 py-8">
    {% block body %}{% endblock %}
  </main>

  <footer class="footer sm:footer-horizontal bg-base-300 text-base-content p-10">
    <nav>
      <h6 class="footer-title">Services</h6>
      <a class="link link-hover">Branding</a>
      <a class="link link-hover">Design</a>
      <a class="link link-hover">Marketing</a>
      <a class="link link-hover">Advertisement</a>
    </nav>
    <nav>
      <h6 class="footer-title">Company</h6>
      <a class="link link-hover">About us</a>
      <a class="link link-hover">Contact</a>
      <a class="link link-hover">Jobs</a>
      <a class="link link-hover">Press kit</a>
    </nav>
    <nav>
      <h6 class="footer-title">Social</h6>
      <div class="grid grid-flow-col gap-4">
        <a></a><a></a><a></a>
      </div>
    </nav>
  </footer>

  {# === FRONT TOASTS: kênh shop.* === #}
  {% set styleMap = {
    'shop.success': 'border-green-300 bg-green-50 text-green-800',
    'shop.error':   'border-rose-300  bg-rose-50  text-rose-800',
    'shop.warning': 'border-amber-300 bg-amber-50 text-amber-900',
    'shop.info':    'border-sky-300   bg-sky-50   text-sky-800'
  } %}
  {% set flashes_front = app.flashes(['shop.success','shop.error','shop.warning','shop.info']) %}
  {% if flashes_front is not empty %}
    <div id="toasts"
         class="fixed z-[100] top-[80px] left-1/2 -translate-x-1/2 w-full max-w-md flex flex-col gap-2 px-4">
      {% for type, messages in flashes_front %}
        {% for message in messages %}
          <div class="toast-item pointer-events-auto flex items-center justify-between gap-3 rounded-md border shadow
                      px-4 py-3 backdrop-blur-sm
                      {{ styleMap[type]|default('border-gray-300 bg-white text-gray-800') }}
                      transition-all duration-300 ease-out opacity-0 translate-y-[-8px]">
            <span class="block leading-snug break-words">{{ message|raw }}</span>
            <button type="button"
                    class="shrink-0 inline-flex items-center justify-center rounded p-1 text-current/70 hover:text-current"
                    aria-label="Close">✕</button>
          </div>
        {% endfor %}
      {% endfor %}
    </div>
    <script>
      (function () {
        const items = Array.from(document.querySelectorAll('#toasts .toast-item'));
        items.forEach((el, idx) => {
          requestAnimationFrame(() => { el.style.opacity = '1'; el.style.transform = 'translateY(0)'; });
          const timer = setTimeout(() => close(el), 3500 + idx * 150);
          el.querySelector('button')?.addEventListener('click', () => { clearTimeout(timer); close(el); });
        });
        function close(el){ el.style.opacity = '0'; el.style.transform = 'translateY(-8px)'; setTimeout(() => el.remove(), 200); }
      })();
    </script>
  {% endif %}

  {% block javascripts_bottom %}{% endblock %}
  </body>
</html>
